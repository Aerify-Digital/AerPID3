Chart.defaults.global.animation.duration=0;const createChart=t=>new Chart(t,{type:"line",animation:!1,labels:["0","16","32","48","64","80","96"],data:{datasets:[{label:"Measure",data:[],borderColor:"red",borderWidth:.9,fill:!1,pointRadius:1.2,yAxisID:"y"},{label:"Average 1 Minute",data:[],borderColor:"orange",borderWidth:2.2,fill:!1,pointRadius:.8,yAxisID:"y"},{label:"Set Temperature",data:[],borderColor:"yellow",borderWidth:1.8,fill:!1,pointRadius:0,yAxisID:"y"},{label:"Measure Trend",data:[],borderColor:"#81d41a",borderWidth:1,fill:!1,pointRadius:0,hidden:!0,yAxisID:"y"},{label:"Output",data:[],borderColor:"magenta",borderWidth:1,fill:!1,pointRadius:1,hidden:!0,yAxisID:"y1"},{label:"Sigma+",data:[],borderColor:"blue",borderWidth:.4,fill:!1,pointRadius:0,hidden:!0,yAxisID:"y"},{label:"Sigma-",data:[],borderColor:"blue",borderWidth:.4,fill:!1,pointRadius:0,hidden:!0,yAxisID:"y"}]},options:{scales:{xAxes:[{gridLines:{display:!0,color:"rgba(255, 255, 255, 0.1)"}}],yAxes:[{id:"y",type:"linear",display:!0,position:"left",gridLines:{display:!0,color:"rgba(255, 255, 255, 0.1)"},scaleLabel:{display:!0,labelString:"Temperature"}},{id:"y1",type:"linear",display:!0,position:"right",color:"blue",ticks:{beginAtZero:!0,color:"blue"},grid:{drawOnChartArea:!1,backdropColor:"blue",color:"blue"},scaleLabel:{display:!1,labelString:"Power"}}]}}}),chart=createChart("temp_chart"),chart2=createChart("temp_chart2");function calculateTrendLine(t){for(var a,e,s,o,r=0,c=0,i=0,n=0,l=t.length,d=0;d<l;d++)i+=Number(t[d].x)*Number(t[d].y);a=i*l;for(d=0;d<l;d++)r+=Number(t[d].x),c+=Number(t[d].y);e=r*c;for(d=0;d<l;d++)n+=Math.pow(Number(t[d].x),2);o=(c-(s=(a-e)/(l*n-Math.pow(r,2)))*r)/l;var h=[];for(d=0;d<l;d++)h.push(getTrendLinePoint(t[d].x,s,o));return h}function getTrendLinePoint(t,a,e){return{x:t,y:a*t+e}}let zoomRefreshTick=0;const maxChartTime=900,updateChart=(t,a,e,s,o,r)=>{t.TEMPS.length>900&&t.TEMPS.shift(),t.TEMPS.push(a),t.TEMPS_AVG.length>900&&t.TEMPS_AVG.shift(),t.TEMPS_AVG.push(e),t.OUTPUT.length>900&&t.OUTPUT.shift(),t.OUTPUT.push(o),t.SIGMA.length>900&&t.SIGMA.shift(),t.SIGMA.push(r);let c=32;"one"==t.TIME_SPAN1?c=64:"two"==t.TIME_SPAN1?c=128:"three"==t.TIME_SPAN1?c=180:"five"==t.TIME_SPAN1?c=300:"seven"==t.TIME_SPAN1?c=420:"ten"==t.TIME_SPAN1?c=600:"fifteen"==t.TIME_SPAN1&&(c=900);const i=[],n=[],l=[],d=[],h=[],f=[],p=[];let A=[];for(let a=0;a<t.TEMPS.length;a++)A.push(t.TEMPS[a]);A=A.reverse();let g=[];for(let a=0;a<t.TEMPS_AVG.length;a++)g.push(t.TEMPS_AVG[a]);g=g.reverse();let b=[];for(let a=0;a<t.OUTPUT.length;a++)b.push(t.OUTPUT[a]);b=b.reverse();let u=[];for(let a=0;a<t.SIGMA.length;a++)u.push(t.SIGMA[a]);u=u.reverse();for(let t=0;t<A.length&&!(t>=c);t++)n.push({x:t,y:A[t]}),d.push({x:t,y:g[t]}),l.push({x:t,y:s}),h.push(b[t]),f.push(Number(g[t])+Number(u[t])),p.push(g[t]-u[t]),A.length<=32?t%2==0?i.push(`${t}`):i.push(""):A.length<=64?t%8==0?i.push(`${t}`):i.push(""):A.length<=128?t%16==0?i.push(`${t}`):i.push(""):t%15==0?i.push(`${t}`):i.push("");let T="";switch(t.UNIT){case TemperatureUnit.FAHRENHEIT:T="°F";break;case TemperatureUnit.KELVIN:T="°K";break;case TemperatureUnit.CELSIUS:default:T="°C"}chart.config.options.scales.yAxes[0].scaleLabel.labelString=`Temperature (${T})`,chart.config.options.scales.yAxes[0].scaleLabel.display=!0,chart.data.datasets[0].data=n,chart.data.datasets[1].data=d,chart.data.datasets[2].data=l,chart.data.datasets[3].data=calculateTrendLine(n),chart.data.datasets[4].data=h,chart.data.datasets[5].data=f,chart.data.datasets[6].data=p,chart.data.labels=i,zoomRefreshTick<=0?(updateZoom(t.ZOOM_LEVEL),zoomRefreshTick=3):zoomRefreshTick--,chart.update()};let zoomRefreshTick2=0;const updateChart2=(t,a,e,s,o,r)=>{t.TEMPS2.length>900&&t.TEMPS2.shift(),t.TEMPS2.push(a),t.TEMPS_AVG2.length>900&&t.TEMPS_AVG2.shift(),t.TEMPS_AVG2.push(e),t.OUTPUT2.length>900&&t.OUTPUT2.shift(),t.OUTPUT2.push(o),t.SIGMA2.length>900&&t.SIGMA2.shift(),t.SIGMA2.push(r);let c=32;"one"==t.TIME_SPAN2?c=64:"two"==t.TIME_SPAN2?c=128:"three"==t.TIME_SPAN2?c=180:"five"==t.TIME_SPAN2?c=300:"seven"==t.TIME_SPAN2?c=420:"ten"==t.TIME_SPAN2?c=600:"fifteen"==t.TIME_SPAN2&&(c=900);const i=[],n=[],l=[],d=[],h=[],f=[];let p=[];for(let a=0;a<t.TEMPS2.length;a++)p.push(t.TEMPS2[a]);p=p.reverse();let A=[];for(let a=0;a<t.TEMPS_AVG2.length;a++)A.push(t.TEMPS_AVG2[a]);A=A.reverse();let g=[];for(let a=0;a<t.OUTPUT2.length;a++)g.push(t.OUTPUT2[a]);g=g.reverse();let b=[];for(let a=0;a<t.SIGMA2.length;a++)b.push(t.SIGMA2[a]);b=b.reverse();for(let t=0;t<p.length&&!(t>=c);t++)n.push({x:t,y:p[t]}),d.push({x:t,y:A[t]}),l.push({x:t,y:s}),h.push(g[t]),f.push(b[t]),p.length<=32?t%2==0?i.push(`${t}`):i.push(""):p.length<=64?t%8==0?i.push(`${t}`):i.push(""):p.length<=128?t%16==0?i.push(`${t}`):i.push(""):t%15==0?i.push(`${t}`):i.push("");let u="";switch(t.UNIT){case TemperatureUnit.FAHRENHEIT:u="°F";break;case TemperatureUnit.KELVIN:u="°K";break;case TemperatureUnit.CELSIUS:default:u="°C"}chart2.config.options.scales.yAxes[0].scaleLabel.labelString=`Temperature (${u})`,chart2.config.options.scales.yAxes[0].scaleLabel.display=!0,chart2.data.datasets[0].data=n,chart2.data.datasets[1].data=d,chart2.data.datasets[2].data=l,chart2.data.datasets[3].data=calculateTrendLine(n),chart2.data.datasets[4].data=h,chart2.data.datasets[5].data=f,chart2.data.labels=i,zoomRefreshTick2<=0?(updateZoom2(t.ZOOM_LEVEL2),zoomRefreshTick2=3):zoomRefreshTick2--,chart2.update()},palletChange=t=>{const a=t.value;"warm"==a?(chart.data.datasets[0].borderColor="red",chart.data.datasets[1].borderColor="orange",chart.data.datasets[2].borderColor="yellow",chart.data.datasets[3].borderColor="#81d41a"):"cool"==a?(chart.data.datasets[0].borderColor="#6A5ACD",chart.data.datasets[1].borderColor="#87faf2",chart.data.datasets[2].borderColor="#4169e1",chart.data.datasets[3].borderColor="#dd4cf4"):"forest"==a?(chart.data.datasets[0].borderColor="#158466",chart.data.datasets[1].borderColor="#40E0D0",chart.data.datasets[2].borderColor="#81d41a",chart.data.datasets[3].borderColor="#2a6099"):"traffic"==a?(chart.data.datasets[0].borderColor="#ff0000",chart.data.datasets[1].borderColor="#ffbf00",chart.data.datasets[2].borderColor="#00a933",chart.data.datasets[3].borderColor="#87faf2"):"void"==a&&(chart.data.datasets[0].borderColor="#ffffff",chart.data.datasets[1].borderColor="#5adac2",chart.data.datasets[2].borderColor="#2a6099",chart.data.datasets[3].borderColor="#650953"),chart.update()},palletChange2=t=>{const a=t.value;"warm"==a?(chart2.data.datasets[0].borderColor="red",chart2.data.datasets[1].borderColor="orange",chart2.data.datasets[2].borderColor="yellow",chart2.data.datasets[3].borderColor="#81d41a"):"cool"==a?(chart2.data.datasets[0].borderColor="#6A5ACD",chart2.data.datasets[1].borderColor="#87faf2",chart2.data.datasets[2].borderColor="#4169e1",chart2.data.datasets[3].borderColor="#dd4cf4"):"forest"==a?(chart2.data.datasets[0].borderColor="#158466",chart2.data.datasets[1].borderColor="#40E0D0",chart2.data.datasets[2].borderColor="#81d41a",chart2.data.datasets[3].borderColor="#2a6099"):"traffic"==a?(chart2.data.datasets[0].borderColor="#ff0000",chart2.data.datasets[1].borderColor="#ffbf00",chart2.data.datasets[2].borderColor="#00a933",chart2.data.datasets[3].borderColor="#87faf2"):"void"==a&&(chart2.data.datasets[0].borderColor="#ffffff",chart2.data.datasets[1].borderColor="#5adac2",chart2.data.datasets[2].borderColor="#2a6099",chart2.data.datasets[3].borderColor="#650953"),chart2.update()},updateZoom=t=>{if(!state.TEMPS||0==state.TEMPS.length)return;let a=1e3,e=0,s=[];for(let t=0;t<state.TEMPS.length;t++)s.push(state.TEMPS[t]);s=s.reverse();let o=32;"one"==state.TIME_SPAN1?o=64:"two"==state.TIME_SPAN1?o=128:"three"==state.TIME_SPAN1?o=180:"five"==state.TIME_SPAN1?o=300:"seven"==state.TIME_SPAN1?o=420:"ten"==state.TIME_SPAN1?o=600:"fifteen"==state.TIME_SPAN1&&(o=900);let r=0;for(const t of s){if(r++>o)break;const s=Number(t);s<a&&s>0&&(a=s),s>e&&(e=s)}const c=e-a,i=.5*c,n=2*c;"auto"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=void 0,chart.config.options.scales.yAxes[0].ticks.max=void 0):"fine"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=a-.1,chart.config.options.scales.yAxes[0].ticks.max=e+.1):"tiny"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=a-1,chart.config.options.scales.yAxes[0].ticks.max=e+1):"near"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=a-i-1,chart.config.options.scales.yAxes[0].ticks.max=e+i+1):"avg"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=a-c-3,chart.config.options.scales.yAxes[0].ticks.max=e+c+3):"far"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=a-n-7,chart.config.options.scales.yAxes[0].ticks.max=e+n+7):"dist"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart.config.options.scales.yAxes[0].ticks.min=a-n-c-10,chart.config.options.scales.yAxes[0].ticks.max=e+n+c+10):"max"==t?(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!0,chart.config.options.scales.yAxes[0].ticks.min=a-c-25,chart.config.options.scales.yAxes[0].ticks.max=e+c+25):"all"==t&&(chart.config.options.scales.yAxes[0].ticks.beginAtZero=!0,chart.config.options.scales.yAxes[0].ticks.min=0,chart.config.options.scales.yAxes[0].ticks.max=e+25)},updateZoom2=t=>{if(!state.TEMPS2||0==state.TEMPS2.length)return;let a=1e3,e=0,s=[];for(let t=0;t<state.TEMPS2.length;t++)s.push(state.TEMPS2[t]);s=s.reverse();let o=32;"one"==state.TIME_SPAN2?o=64:"two"==state.TIME_SPAN2?o=128:"three"==state.TIME_SPAN2?o=180:"five"==state.TIME_SPAN2?o=300:"seven"==state.TIME_SPAN2?o=420:"ten"==state.TIME_SPAN2?o=600:"fifteen"==state.TIME_SPAN2&&(o=900);let r=0;for(const t of s){if(r++>o)break;const s=Number(t);s<a&&s>0&&(a=s),s>e&&(e=s)}const c=e-a,i=.5*c,n=2*c;"auto"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=void 0,chart2.config.options.scales.yAxes[0].ticks.max=void 0):"fine"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=a-.1,chart2.config.options.scales.yAxes[0].ticks.max=e+.1):"tiny"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=a-1,chart2.config.options.scales.yAxes[0].ticks.max=e+1):"near"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=a-i-1,chart2.config.options.scales.yAxes[0].ticks.max=e+i+1):"avg"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=a-c-3,chart2.config.options.scales.yAxes[0].ticks.max=e+c+3):"far"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=a-n-7,chart2.config.options.scales.yAxes[0].ticks.max=e+n+7):"dist"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!1,chart2.config.options.scales.yAxes[0].ticks.min=a-n-c-10,chart2.config.options.scales.yAxes[0].ticks.max=e+n+c+10):"max"==t?(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!0,chart2.config.options.scales.yAxes[0].ticks.min=a-c-25,chart2.config.options.scales.yAxes[0].ticks.max=e+c+25):"all"==t&&(chart2.config.options.scales.yAxes[0].ticks.beginAtZero=!0,chart2.config.options.scales.yAxes[0].ticks.min=0,chart2.config.options.scales.yAxes[0].ticks.max=e+25)};